
## é¡¹ç›®æ–‡ä»¶é¡ºåº
|- test1
|- loader1
|- loader2


## webpackè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- ç¬¬ä¸€é˜¶æ®µ
Gruntã€Gulp è¿™ç±»æ„å»ºå·¥å…·ï¼Œæ‰“åŒ…çš„æ€è·¯æ˜¯ï¼šéå†æºæ–‡ä»¶â†’åŒ¹é…è§„åˆ™â†’æ‰“åŒ…ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åšä¸åˆ°æŒ‰éœ€åŠ è½½ï¼Œå³å¯¹äºæ‰“åŒ…èµ·æ¥çš„èµ„æºï¼Œåˆ°åº•é¡µé¢ç”¨ä¸ç”¨ï¼Œæ‰“åŒ…è¿‡ç¨‹ä¸­æ˜¯ä¸å…³å¿ƒçš„ã€‚

- ç¬¬äºŒé˜¶æ®µ
webpack æ˜¯ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œç»è¿‡æ¨¡å—ä¾èµ–åŠ è½½ã€åˆ†æå’Œæ‰“åŒ…ä¸‰ä¸ªæµç¨‹å®Œæˆé¡¹ç›®çš„æ„å»ºã€‚åœ¨åŠ è½½ã€åˆ†æå’Œæ‰“åŒ…çš„ä¸‰ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é’ˆå¯¹æ€§çš„åšä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚code splitï¼ˆæ‹†åˆ†å…¬å…±ä»£ç ç­‰ï¼‰ã€‚

- webpackå¸¸åšçš„ä¸€äº›äº‹æƒ…
    - æ¨¡å—åŒ–æ‰“åŒ…ï¼Œä¸€åˆ‡çš†æ¨¡å—ï¼ŒJS æ˜¯æ¨¡å—ï¼ŒCSS ç­‰ä¹Ÿæ˜¯æ¨¡å—ï¼›
    - è¯­æ³•ç³–è½¬æ¢ï¼šæ¯”å¦‚ ES6 è½¬ ES5ã€TypeScriptï¼›
    - é¢„å¤„ç†å™¨ç¼–è¯‘ï¼šæ¯”å¦‚ Lessã€Sass ç­‰ï¼›
    - é¡¹ç›®ä¼˜åŒ–ï¼šæ¯”å¦‚å‹ç¼©ã€CDNï¼›
    - è§£å†³æ–¹æ¡ˆå°è£…ï¼šé€šè¿‡å¼ºå¤§çš„ Loader å’Œæ’ä»¶æœºåˆ¶ï¼Œå¯ä»¥å®Œæˆè§£å†³æ–¹æ¡ˆçš„å°è£…ï¼Œæ¯”å¦‚PWAï¼›
    - æµç¨‹å¯¹æ¥ï¼šæ¯”å¦‚æµ‹è¯•æµç¨‹ã€è¯­æ³•æ£€æµ‹ç­‰ã€‚

## npmå¸¸ç”¨å‘½ä»¤
```
npm info lodash  æŸ¥çœ‹æŸä¸ªåŒ…çš„ä¿¡æ¯
npm search lodash  æŸ¥è¯¢æ‰€æœ‰å¸¦lodashçš„npmåŒ…
npm list --global æŸ¥çœ‹å…¨å±€å®‰è£…çš„æ¨¡å—
```

## webpackç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ
æ˜¯ä¸€ä¸ª[æ¨¡å—æ‰“åŒ…å·¥å…·]ï¼Œç°åœ¨æˆ‘ä»¬å­¦ä¹ webpack4.0ç‰ˆæœ¬
```
1ã€yarn init -y
2ã€yarn add webpack-cli@3.1.2 -D
3ã€yarn add webpack@4.25.1
4ã€npx webpack index.js  // webapckå¯¹index.jsçš„å†…å®¹è¿›è¡Œæ‰“åŒ…

npx webpack -v  æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸­webpackçš„ç‰ˆæœ¬
npm info webpack  æŸ¥çœ‹webpackçš„å†å²ç‰ˆæœ¬

webpack-cliçš„ä½œç”¨ï¼šåœ¨å‘½ä»¤è¡Œä¸­å¯ä»¥æ‰§è¡ŒwebpackæŒ‡ä»¤ã€‚

å¦‚æœåˆ›å»ºäº†webpack.config.jsä¹‹åï¼ˆwebpack.config.jsæ˜¯é»˜è®¤é…ç½®æ–‡ä»¶ï¼‰ï¼Œç›´æ¥è¾“å…¥å°±å¯ä»¥`npx webpack`æ‰“åŒ…äº†ã€‚
å¦‚æœæƒ³æŒ‰ç…§æ–‡ä»¶config1.jsçš„é…ç½®è¿›è¡Œæ‰“åŒ…ï¼Œåˆ™è¾“å…¥`npx webpack --config config1.js`å³å¯å®ç°ã€‚

åœ¨package.jsonä¸­é…ç½®scriptsè„šæœ¬è¿è¡Œï¼Œä»–ä¼šå…ˆå»æ‰€åœ¨å·¥ç¨‹é¡¹ç›®ä¸­æ‰¾webpackï¼Œç„¶åå†å»å…¨å±€æ‰¾ã€‚ç„¶åå†å‘½ä»¤è¡Œä¹‹ånpm run bundleå°±å¯ä»¥æ‰§è¡Œäº†ã€‚
"scripts": {
    "bundle": "webpack"
}
```

## å°è¯•ä¸¤ç§æš´éœ²å’Œå¼•ç”¨æ¨¡å—çš„æ–¹å¼
- ES Moudule æ¨¡å—å¼•å…¥æ–¹å¼
    - export default HeadModule
    - import HeadModule from './head.js'
- commonjsæ¨¡å—å¼•å…¥æ–¹å¼
    - module.exports = HeadModule
    - const HeadModule = require('./head.js')



- å‚è€ƒèµ„æ–™ï¼š
https://v4.webpack.js.org/concepts/modules/  æ¨¡å—
https://v4.webpack.js.org/guides/   å¼€å§‹å…¥é—¨



## loaderæ˜¯ä»€ä¹ˆï¼Ÿ
æ˜¯ä¸€ç§æ‰“åŒ…æ–¹æ¡ˆã€‚
ä»–èƒ½è®©æŸç§ç‰¹å®šæ–‡ä»¶ä»¥æ€æ ·çš„æ–¹å¼æ‰“åŒ…ã€‚
åªè¦ä¸æ˜¯.jsç»“å°¾çš„æ–‡ä»¶ï¼Œéƒ½éœ€è¦é€šè¿‡é…ç½®loaderæ‰“åŒ…ï¼Œä¸ç„¶ä¼šå‡ºç°æ‰“åŒ…å¤±è´¥çš„æƒ…å†µã€‚

é…ç½®æ–¹å¼ä¾‹å­å¦‚ä¸‹ï¼š
```
module: {
    rules: [
        {  // ç”¨file-loaderå°†å›¾æ ‡æ–‡å­—ç»™è§£æ
            test: /\.(eot|woff2|woff|ttf|svg)$/i,
            use: ['file-loader']
        }
        ...
    ]
}
```

### file-loader
æµ‹è¯•ä»£ç åœ¨loader1ï¼Œé€‚åˆè¾ƒå¤§çš„å›¾ç‰‡ã€‚åé¢æ‰“åŒ…å­—ä½“å›¾æ ‡ä¹Ÿç”¨äº†è¿™ä¸ªloader

é»˜è®¤æƒ…å†µä¸‹ç”Ÿæˆçš„æ–‡ä»¶åå°±æ˜¯æ–‡ä»¶å†…å®¹çš„md5+æ–‡ä»¶æ‰©å±•åã€‚

### url-loaderï¼ˆæ¨èè¿™ä¸ªï¼‰
æµ‹è¯•ä»£ç åœ¨loader1ï¼Œé€‚åˆè¾ƒå°çš„å›¾ç‰‡ã€‚
ä½¿ç”¨limitåšå›¾ç‰‡çš„å¤§å°é™åˆ¶ã€‚

è¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šå®‰è£…äº†url-loaderå°±ä¸ç”¨å†å®‰è£…file-loaderï¼Œå› ä¸ºurl-loaderçš„`fallback`é»˜è®¤æ˜¯file-loaderï¼Œå³å½“é™åˆ¶å¤§å°è¶…è¿‡äº†è®¾ç½®åˆ™ç”¨`file-loader`çš„é…ç½®æ–¹å¼ã€‚


### æ‰“åŒ…css
- style-loaderå’Œcss-loaderä¹‹é—´çš„å…³ç³»
1ã€å¦‚æœåœ¨JSä¸­å¯¼å…¥äº†cssï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ css-loader æ¥è¯†åˆ«è¿™ä¸ªæ¨¡å—ï¼Œé€šè¿‡ç‰¹å®šçš„è¯­æ³•è§„åˆ™è¿›è¡Œè½¬æ¢å†…å®¹æœ€åå¯¼å‡ºã€‚å¯ä»¥å¤„ç†import / require @import / urlå¼•å…¥çš„å†…å®¹ã€‚
2ã€css-loaderå¤„ç†ä¹‹åå¯¼å‡ºçš„æ˜¯ï¼šå¸¦æœ‰csså†…å®¹çš„æ¨¡å—çš„æ•°ç»„ï¼Œé¡µé¢æ˜¯æ— æ³•ä½¿ç”¨è¿™æ ·ä¸€ä¸ªæ•°æ®çš„ï¼Œéœ€è¦style-loaderæ¥å¤„ç†ã€‚

å¦‚æœå•ç‹¬ä½¿ç”¨style-loaderä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å®ƒäº§ç”Ÿçš„æ ·å¼ä¼šç›´æ¥æ’å…¥åˆ°htmlçš„å¤´éƒ¨ã€‚


æµ‹è¯•ä»£ç åœ¨loader1ã€‚moduleé…ç½®çš„æ‰§è¡Œé¡ºåºæ˜¯ã€Œä»ä¸‹åˆ°ä¸Šï¼Œä»å³åˆ°å·¦ã€
- style-loader
    - å°†æ ·å¼æ–‡ä»¶å†™åœ¨htmlçš„å¤´éƒ¨ï¼Œå¹¶ä¸è´Ÿè´£è§£æcssä¹‹é—´çš„ä¾èµ–å…³ç³»
- css-loader
    - å°†ç›¸å…³çš„cssæ–‡ä»¶æ±‡æ€»ï¼Œæ•´åˆåˆ°ä¸€ä¸ªcssæ–‡ä»¶ä¸­
- less-loader
    - è§£æå’Œæ‰“åŒ….lessæ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„æ˜¯ç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜ã€‚
        - æˆ‘è¿™é‡Œæ˜¯less@3.9.0,less-loader@5.0.0ã€‚
- postcss-loader
    - å¡«å……css3çš„å…¼å®¹å†™æ³•ï¼Œè‡ªåŠ¨å¢åŠ æµè§ˆå™¨å‚å•†æ ‡è¯†
        - é™¤æ­¤ä¹‹å¤–ï¼Œéœ€è¦å®‰è£…autoprefixer@9.3.1å’Œé…ç½®æ–‡ä»¶`postcss.config.js`å¸®åŠ©å®Œæˆè‡ªåŠ¨æ·»åŠ å‰ç¼€çš„åŠŸèƒ½ã€‚

#### å¢åŠ ä¸€äº›cssé…ç½®çš„è®²è§£ï¼ˆcss modulesï¼‰
æµ‹è¯•ä»£ç åœ¨loader2ã€‚

- å¢åŠ css modulesçš„é…ç½®ï¼Œå³æ ·å¼ç§æœ‰åŒ–ã€‚
    - importLoaders: 2,  // æŒ‡é€šè¿‡importè¯­æ³•å¼•å…¥çš„lessæ–‡ä»¶ï¼Œä¹Ÿä¼šå…ˆèµ°ä¸‹é¢2ä¸ªloaderï¼Œæ‰ä¼šèµ°css-loaderï¼ˆï¼‰
    - modules: true,  // å¼€å¯cssæ¨¡å—åŒ–ï¼ˆå³cssç§æœ‰æ€§ï¼‰ï¼ŒæŸ¥çœ‹æ ·å¼å‘ç°ç±»åå˜æˆhashçš„äº†ã€‚

- é…ç½®å­—ä½“å›¾æ ‡
    - è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æ·»åŠ css-loaderçš„æ¨¡å—ç§æœ‰åŒ–ä¹‹åæ ·å¼å°±æ²¡ç”Ÿæ•ˆäº†ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Ÿ   ğŸ‘ƒ
ä½¿ç”¨`file-loader`è¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…ï¼Œç„¶åå¼•å…¥iconfontçš„å›¾æ ‡åº“


- å‚è€ƒèµ„æ–™ï¼š
https://v4.webpack.js.org/loaders/   loaderå†…å®¹




## pluginé…ç½®
pluginå¯ä»¥åœ¨webpackè¿è¡Œåˆ°æŸä¸ªæ—¶åˆ»çš„æ—¶å€™ï¼Œå¸®ä½ åšä¸€äº›äº‹æƒ…ã€‚

- html-webpack-plugin
ä½œç”¨æ˜¯ï¼šHtmlWebpackPluginä¼šåœ¨æ‰“åŒ…ç»“æŸåï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå¹¶æŠŠæ‰“åŒ…ç”Ÿæˆçš„jsè‡ªåŠ¨å¼•å…¥åˆ°è¿™ä¸ªhtmlæ–‡ä»¶ä¸­ã€‚
å¯ä»¥è®¾ç½®ä¸€ä¸ªindex.htmlçš„æ¨¡æ¿æ–‡ä»¶ï¼Œä»¥ä»–ä¸ºæ¨¡æ¿å…¥å£åœ¨distæ–‡ä»¶ä¸‹ç”Ÿæˆã€‚

- clean-webpack-plugin@1.0.0ï¼ˆå­˜åœ¨ç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜ï¼‰

ä½œç”¨æ˜¯ï¼šæ‰“åŒ…ä¹‹å‰åˆ é™¤ä¸Šä¸€æ¬¡æ‰“åŒ…äº§ç”Ÿçš„è®°å½•ï¼Œå¯é…ç½®æ‰“åŒ…çš„æ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šdistï¼‰


## entryå’Œoutput
- ä»ä¸€ä¸ªæœ€åŸºç¡€çš„é…ç½®å¼€å§‹åˆ†æã€‚
entryè¡¨ç¤ºä»¥src/index.jsä½œä¸ºå…¥å£è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…ä¹‹åé»˜è®¤åç§°å«åšmain.jsã€‚
outputè¡¨ç¤ºå¯¹æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶é‡æ–°å‘½åä¸ºbundle.jsï¼Œå¹¶é…ç½®æ‰“åŒ…åçš„æ–‡ä»¶å¤¹åç§°ä¸ºdistã€‚
```
entry: {
    'main': './src/index.js',
},
output: {
    filename: 'bundle.js',  // æ‰“åŒ…åçš„æ–‡ä»¶å
    path: path.resolve(__dirname, 'dist')  //é…ç½®æ–‡ä»¶è·¯å¾„
}
```

- å¦‚æœè¦å¯¹ä¸¤ä¸ªå…¥å£æ–‡ä»¶è¿›è¡Œæ‰“åŒ…æ€ä¹ˆé…ç½®å‘¢ï¼Ÿ
ä¸¤ä¸ªå…¥å£åˆ†åˆ«æ˜¯mainå’Œsubï¼Œæ‰“åŒ…ä¹‹åçš„æ–‡ä»¶åå³ä¸ºmain.jså’Œsub.js
```
entry: {
    'main': './src/index.js',
    'sub': ''./src/content.js
},
output: {
    publicPath: 'http://www.family.cn'   // è¿™ä¸ªæ˜¯é…ç½®cdnåœ°å€ï¼Œä¼šåœ¨å¼•å…¥æ–‡ä»¶å‰åŠ ä¸Šè¿™ä¸ªé“¾æ¥ã€‚
    filename: '[name].[ext]',  // æ‰“åŒ…åçš„æ–‡ä»¶å
    path: path.resolve(__dirname, 'dist')  //é…ç½®æ–‡ä»¶è·¯å¾„
}
```

- å‚è€ƒèµ„æ–™ï¼š
https://v4.webpack.js.org/configuration/entry-context/   entry(ç®€å•çœ‹)
https://v4.webpack.js.org/configuration/output/#outputpublicpath    output(ç®€å•çœ‹)
https://v4.webpack.js.org/guides/output-management/   output-management(é€è¡Œçœ‹ï¼‰
https://v4.webpack.js.org/plugins/html-webpack-plugin(ä»”ç»†çœ‹)


